import axiosInstance from "./axiosInstance";

// âœ… 1. ê³ ì •ëœ í”„ë¡œì íŠ¸ ì„¤ëª… ë° ìš”ì²­ ë°©ì‹ (ë©´ì ‘ ì§ˆë¬¸ì„ ë” ì •êµí•˜ê²Œ ê°œì„ )
const PROJECT_DESCRIPTION = `
ë‹¹ì‹ ì€ ë©´ì ‘ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì§€ì›ìì˜ ì‹¤ì œ ì„œë¥˜ ë°ì´í„°ì™€, ì§€ì›ìê°€ ì§€ì›í•œ ê¸°ì—…ì˜ í‰ê°€ ê¸°ì¤€ì— ë§ê²Œ ì‹¤ì œ ë©´ì ‘ ì§ˆë¬¸ì„ ìƒì„±í•©ë‹ˆë‹¤.
ë°ì´í„°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
1. ì§€ì›ì ì‹ë³„ ë²ˆí˜¸
2. í•´ë‹¹ ì§€ì›ìê°€ ê¸°ì…í•œ ì‹¤ì œ ì •ë³´
   - í‚¤ : value ê°’
   - í‚¤ëŠ” 'ìê¸°ì†Œê°œì„œ'ì…ë‹ˆë‹¤.
   - ì§ˆë¬¸ì€ ìì†Œì„œ ë‚´ìš©ì„ ê²€ì¦í•˜ê±°ë‚˜, ë…¼ë¦¬ì ì¸ í—ˆì ì„ ì§šê±°ë‚˜, ì¶”ê°€ ê·¼ê±°ë¥¼ ìš”êµ¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.
3. ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ì§ˆë¬¸ì˜ ê°œìˆ˜ëŠ”, ì¶”ê°€ ìš”ì²­ ì‚¬í•­ì„ ì½ê³  ì ì–´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
4. ê° ì§ˆë¬¸ì˜ ê·¼ê±°(ì¶œì²˜)ê°€ ë˜ëŠ” ìì†Œì„œ ë¬¸ì¥ì„ í•¨ê»˜ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
`;

// âœ… 3. ê³ ì •ëœ ì‘ë‹µ í˜•ì‹
const RESPONSE_FORMAT = `
ì‘ë‹µì€ ë°˜ë“œì‹œ ë‹¤ìŒê³¼ ê°™ì€ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:
{
  "key_number": "ì§€ì›ì ì‹ë³„ë²ˆí˜¸",
  "cover_letter_num": ì§ˆë¬¸ì„ ë§Œë“¤ ìì†Œì„œ ê°œìˆ˜,
  "question_num": ê° ìì†Œì„œë³„ ë§Œë“¤ ì§ˆë¬¸ ê°œìˆ˜,
  "question1-1": "1ë²ˆ ìì†Œì„œì— ëŒ€í•œ ì§ˆë¬¸ 1",
  "question1-2": "1ë²ˆ ìì†Œì„œì— ëŒ€í•œ ì§ˆë¬¸ 2",
  "clue1-1": "1ë²ˆ ìì†Œì„œ 1ë²ˆ ì§ˆë¬¸ì— ëŒ€í•œ ê·¼ê±°(ì¶œì²˜)",
  "clue1-2": "1ë²ˆ ìì†Œì„œ 2ë²ˆ ì§ˆë¬¸ì— ëŒ€í•œ ê·¼ê±°(ì¶œì²˜)",
  "questionN-M": "Në²ˆ ìì†Œì„œì— ëŒ€í•œ ì§ˆë¬¸ M",
  "clueN-M": "Në²ˆ ìì†Œì„œ Më²ˆ ì§ˆë¬¸ì— ëŒ€í•œ ê·¼ê±°(ì¶œì²˜)"
}
JSON ì´ì™¸ì˜ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì§€ ë§ˆì„¸ìš”.
`;

/**
 * âœ… GPTì— í”„ë¡¬í”„íŠ¸ë¥¼ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ì•„ì˜¤ëŠ” í•¨ìˆ˜
 * @param {Object} userData - ì‚¬ìš©ìê°€ ì„ íƒí•œ ê°œë³„ ì§€ì›ì ë°ì´í„°
 * @param {string} userRequest - ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•œ ì¶”ê°€ ìš”ì²­ ì‚¬í•­
 * @param {string} secretPassword - API ìš”ì²­ ì‹œ ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸
 * @returns {Object} GPTì˜ ì‘ë‹µ ë°ì´í„°
 */
export const sendPrompt = async (userData, userRequest, secretPassword) => {
    if (!userData || !userData.key_number) {
        throw new Error("âŒ ìœ íš¨í•œ ì§€ì›ì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. key_numberê°€ í•„ìš”í•©ë‹ˆë‹¤.");
    }

    // âœ… 2. ì‚¬ìš©ì ì‹¤ì œ ë°ì´í„° (ê°œë³„ ì§€ì›ì)
    const userDataString = JSON.stringify(userData, null, 2);

    // âœ… 4. ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•œ ì¶”ê°€ ìš”ì²­ ì‚¬í•­
    const userRequestString = userRequest.trim() ? `\nì¶”ê°€ ìš”ì²­ ì‚¬í•­: ${userRequest}` : "";

    // âœ… ìµœì¢… í”„ë¡¬í”„íŠ¸ êµ¬ì„±
    const finalPrompt = `
${PROJECT_DESCRIPTION}

[ì‚¬ìš©ì ë°ì´í„°]
${userDataString}

[ì‘ë‹µ í˜•ì‹]
${RESPONSE_FORMAT}
${userRequestString}
`;

    console.log("ğŸ”¹ ìµœì¢… GPT ìš”ì²­ í”„ë¡¬í”„íŠ¸:", finalPrompt);

    try {
        // âœ… API ìš”ì²­ (í™˜ê²½ë³€ìˆ˜ì—ì„œ ë¶ˆëŸ¬ì˜¨ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©)
        const response = await axiosInstance.post("/gpt/generate-text", {
            prompt: finalPrompt,
            max_tokens: 2000,  // âœ… í† í° ìˆ˜ ì¦ê°€
            secretPassword
        });

        console.log("ğŸŸ¢ GPT ì‘ë‹µ ë°ì´í„°:", response.data); // âœ… ì‘ë‹µ í™•ì¸ìš© ì½˜ì†” ë¡œê·¸

        return response.data;
    } catch (error) {
        console.error("âŒ API ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
        throw error;
    }
};
